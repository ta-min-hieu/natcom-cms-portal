<!DOCTYPE html>
<html lang="en" layout:decorate="~{kakoak_layout_buu_v2.html}"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org">
<head>
</head>
<body>
<div layout:fragment="page_go_back">
    <a th:href="@{/merchant/index}" class="d-inline-flex card card-default mb-0 mr-3 ml-2 justify-content-center align-items-center" style="width: 36px; height: 36px;">
        <svg width="18" height="14" viewBox="0 0 18 14" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M16.5 6.16657H3.51169L7.92252 1.75574C8.00212 1.67887 8.0656 1.58691 8.10928 1.48524C8.15295 1.38357 8.17594 1.27422 8.1769 1.16357C8.17786 1.05292 8.15678 0.94319 8.11488 0.840777C8.07298 0.738363 8.0111 0.645319 7.93285 0.567076C7.85461 0.488832 7.76157 0.426954 7.65915 0.385053C7.55674 0.343153 7.44701 0.322068 7.33636 0.32303C7.22571 0.323991 7.11636 0.34698 7.01469 0.390654C6.91302 0.434328 6.82106 0.497813 6.74419 0.577405L0.910859 6.41074C0.754633 6.56701 0.66687 6.77893 0.66687 6.9999C0.66687 7.22087 0.754633 7.4328 0.910859 7.58907L6.74419 13.4224C6.90136 13.5742 7.11186 13.6582 7.33036 13.6563C7.54886 13.6544 7.75787 13.5668 7.91237 13.4123C8.06688 13.2577 8.15452 13.0487 8.15642 12.8302C8.15832 12.6117 8.07432 12.4012 7.92252 12.2441L3.51169 7.83324H16.5C16.721 7.83324 16.933 7.74544 17.0893 7.58916C17.2456 7.43288 17.3334 7.22092 17.3334 6.9999C17.3334 6.77889 17.2456 6.56693 17.0893 6.41065C16.933 6.25437 16.721 6.16657 16.5 6.16657Z" fill="#808080"/>
        </svg>
    </a>
</div>
<div th:if="${merchant.id != null}" th:attr="onclick=|seeHistoryVersion(${merchant.id})|" class="d-inline-flex align-items-center mr-3" style="cursor: pointer;" layout:fragment="page_path">
    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
        <g clip-path="url(#clip0_13234_22698)">
            <path d="M16.0547 0.342773V3.90598H19.6176L16.0547 0.342773Z" fill="#495057"/>
            <path d="M15.4688 5.07812C15.1452 5.07812 14.8828 4.81578 14.8828 4.49219V0H6.48438C5.51512 0 4.72656 0.788555 4.72656 1.75781V8.30816C4.91961 8.29066 5.11496 8.28125 5.3125 8.28125C7.30969 8.28125 9.09754 9.19438 10.2807 10.625H16.6406C16.9642 10.625 17.2266 10.8873 17.2266 11.2109C17.2266 11.5345 16.9642 11.7969 16.6406 11.7969H11.0527C11.427 12.5274 11.6573 13.3231 11.7309 14.1406H16.6406C16.9642 14.1406 17.2266 14.403 17.2266 14.7266C17.2266 15.0502 16.9642 15.3125 16.6406 15.3125H11.7309C11.5557 17.2476 10.5218 18.9385 9.01398 20H18.2031C19.1724 20 19.9609 19.2114 19.9609 18.2422V5.07812H15.4688ZM16.6406 8.28125H8.04688C7.72328 8.28125 7.46094 8.01891 7.46094 7.69531C7.46094 7.37172 7.72328 7.10938 8.04688 7.10938H16.6406C16.9642 7.10938 17.2266 7.37172 17.2266 7.69531C17.2266 8.01891 16.9642 8.28125 16.6406 8.28125Z" fill="#495057"/>
            <path d="M5.3125 9.45312C2.40473 9.45312 0.0390625 11.8188 0.0390625 14.7266C0.0390625 17.6343 2.40473 20 5.3125 20C8.22027 20 10.5859 17.6343 10.5859 14.7266C10.5859 11.8188 8.22027 9.45312 5.3125 9.45312ZM6.875 15.3125H5.3125C4.98891 15.3125 4.72656 15.0502 4.72656 14.7266V12.3828C4.72656 12.0592 4.98891 11.7969 5.3125 11.7969C5.63609 11.7969 5.89844 12.0592 5.89844 12.3828V14.1406H6.875C7.19859 14.1406 7.46094 14.403 7.46094 14.7266C7.46094 15.0502 7.19859 15.3125 6.875 15.3125Z" fill="#495057"/>
        </g>
        <defs>
            <clipPath id="clip0_13234_22698">
                <rect width="20" height="20" fill="white"/>
            </clipPath>
        </defs>
    </svg>
    <span class="ml-1" style="font-weight: 400; font-size: 16px; user-select: none;" th:text="#{history-version}">History version</span>
</div>
<div layout:fragment="page_action">
    <!--Staff-->
    <th:block th:if="${!@permissionVoucher.checkAdminVoucher()}">
        <button onclick="submitForm(false)" th:if="${status != 3}" id="saveDraft" type="button" class="btn btn-outline-success mx-2" style="border-color: #28a745;">
            <i class="fa-regular fa-floppy-disk"></i><span class="px-2" th:text="#{save-draft}">Edit</span>
        </button>
        <button onclick="submitForm(true)" th:if="${status == 2 || status == 4}" id="submitDraft" type="button" class="btn btn-primary mx-2">
            <i class="fa-regular fa-floppy-disk"></i><span class="px-2" th:text="#{submit}">Submit</span>
        </button>
    </th:block>
    <!--Admin-->
    <th:block th:if="${@permissionVoucher.checkAdminVoucher()}">
        <button th:if="${status == 3 || status == 4}" th:attr="onclick=|approveAll([${form.id}])|" type="button" class="btn btn-success mx-2">
            <i class="fas fa-check-circle"></i><span class="px-2" th:text="#{approve}">Approve</span>
        </button>
        <button th:if="${status == 3}" th:attr="onclick=|disapproveAll([${form.id}])|" type="button" class="btn btn-danger mx-2">
            <i class="fas fa-times-circle"></i><span class="px-2" th:text="#{reject}">Reject</span>
        </button>
        <button th:if="${status == 1}" th:attr="onclick=|lockAll([${form.id}])|" type="button" class="btn btn-warning mx-2">
            <i class="fas fa-lock"></i><span class="px-2" th:text="#{lock}">Lock</span>
        </button>
        <button th:if="${status == 0}" th:attr="onclick=|unlockAll([${form.id}])|" type="button" class="btn btn-warning mx-2">
            <i class="fas fa-lock-open"></i><span class="px-2" th:text="#{unlock}">Unlock</span>
        </button>
    </th:block>
</div>
<div class="content" layout:fragment="page_content">
    <div class="container-fluid" th:with="checkAllow=${(status == 2 || status == 4) && !@permissionVoucher.checkAdminVoucher()},
                                          checkReadonly=${(status != null && status != 2 && status != 4) || (merchant != null && merchant.officialMerchant != null && merchant.officialMerchant?.status != 2 && merchant.officialMerchant?.status != 4)}">
        <div class="card card-default">
            <div class="card-body">
                <form id="form" th:action="@{/merchant/save}" method="post" th:object="${form}" enctype="multipart/form-data">
                    <div class="row">
                        <input hidden th:field="*{id}"/>
                        <input hidden name="status" id="status" th:value="${status}"/>
                        <input hidden name="checkSubmit" id="checkSubmit"/>

                        <div class="col-md-4 form-group">
                            <div th:insert="buu-component :: input-text-v3(#{m-name}, 'name', *{name}, 0, 255, true, false, ${!checkAllow})"></div>
                            <p th:if="${#fields.hasErrors('name')}" th:errors="*{name}" class="text-danger m-0"></p>
                        </div>
                        <div class="col-md-4 form-group">
                            <div th:insert="buu-component :: input-text-v3(#{owner-phonenumber}, 'ownerPhoneNumber', *{ownerPhoneNumber}, 0, 255, true, false, ${!checkAllow})"></div>
                            <p th:if="${#fields.hasErrors('ownerPhoneNumber')}" th:errors="*{ownerPhoneNumber}" class="text-danger m-0"></p>
                        </div>
                        <div class="col-md-4 form-group">
                            <div th:insert="buu-component :: input-text-v3(#{owner-name}, 'ownerName', *{ownerName}, 0, 255, true, false, ${!checkAllow})"></div>
                            <p th:if="${#fields.hasErrors('ownerName')}" th:errors="*{ownerName}" class="text-danger m-0"></p>
                        </div>
                        <div class="col-md-4 form-group" th:with="options=${T(java.util.Arrays).asList(
                            '0', 'Electoral card',
                            '1', 'BI card',
                            '2', 'Passport'
                        )}">
                            <div th:replace="buu-component :: select-default-v2(#{owner-id-paper-type}, 'ownerIdPaperType', *{ownerIdPaperType}, true, ${!checkAllow}, ${options})"></div>
                            <p th:if="${#fields.hasErrors('ownerIdPaperType')}" th:errors="*{ownerIdPaperType}" class="text-danger m-0"></p>
                        </div>
                        <div class="col-md-4 form-group">
                            <div th:insert="buu-component :: input-text-v3(#{owner-id-paper-number}, 'ownerIdPaperNumber', *{ownerIdPaperNumber}, 0, 255, true, false, ${!checkAllow})"></div>
                            <p th:if="${#fields.hasErrors('ownerIdPaperNumber')}" th:errors="*{ownerIdPaperNumber}" class="text-danger m-0"></p>
                        </div>
                        <div class="col-md-4 form-group" th:with="options=${T(java.util.Arrays).asList(
                            'other', 'Other',
                            'mosan', 'Mosan'
                        )}">
                            <div th:replace="buu-component :: select-default-v2(#{typee}, 'type', *{type}, true, ${checkReadonly}, ${options})"></div>
                            <p th:if="${#fields.hasErrors('type')}" th:errors="*{type}" class="text-danger m-0"></p>
                        </div>
                        <div class="col-md-4 form-group">
                            <div th:insert="buu-component :: input-text-v3(#{number-of-staff}, 'totalStaff', 0, 0, 255, true, false, true)"></div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="row">
            <div class="col-6 mb-3">
                <div class="card card-default h-100">
                    <div class="card-body">
                        <div class="d-flex w-100 justify-content-between align-items-center">
                            <p class="m-0 p-0" style="font-weight: 700; font-size: 14px;">List of sub-merchant</p>
                            <button th:if="${checkAllow}" onclick="hideAreaStaff(); renderFormSubMerchant('Create sub merchant', {ownerIdPaperType: '0'});" th:unless="${@permissionVoucher.checkAdminVoucher()}" class="btn btn-primary my-0 mx-1">
                                <i class="fas fa-plus"></i><span class="px-2" th:text="#{voucher-create}">Create</span>
                            </button>
                        </div>
                        <div class="w-100" id="placeRenderSubMerchants"></div>
                    </div>
                </div>
            </div>
            <div class="col-6 mb-3">
                <div class="card card-default h-100">
                    <div class="card-body">
                        <div id="areaStaff" style="display: none;">
                            <div class="d-flex w-100 justify-content-between align-items-center">
                                <p id="titleAreaStaff" class="m-0 p-0" style="font-weight: 700; font-size: 14px;">List staff of sub merchant: </p>
                                <div>
                                    <button onclick="hideAreaStaff()" type="button" class="btn btn-outline-success mx-2" style="border-color: #28a745;">
                                        <span class="px-2" th:text="#{cancel}">Cancel</span>
                                    </button>
                                </div>
                            </div>
                            <div class="w-100" id="placeRenderStaffs"></div>
                        </div>
                        <div id="areaFormSubMerchant" th:style="${!checkAllow ? 'display: none;' : ''}">
                            <div class="d-flex w-100 justify-content-between align-items-center mb-3">
                                <p id="titleAreaFormSubMerchant" class="m-0 p-0" style="font-weight: 700; font-size: 14px;">Create sub merchant</p>
                                <div>
                                    <button onclick="hideAreaFormSubMerchant()" type="button" class="btn btn-outline-success mx-2" style="border-color: #28a745;">
                                        <span class="px-2" th:text="#{cancel}">Cancel</span>
                                    </button>
                                    <button th:if="${checkAllow}" onclick="saveFormSubMerchant();" th:unless="${@permissionVoucher.checkAdminVoucher()}" class="btn btn-primary my-0 mx-1">
                                        <span class="px-2" th:text="#{save}">Save</span>
                                    </button>
                                </div>
                            </div>
                            <div class="w-100">
                                <div class="row">
                                    <input hidden id="smIdMerchant" name="smIdMerchant" th:value="${form.id}"/>
                                    <input hidden id="smId" name="smId" value=""/>
                                    <div class="col-6 form-group">
                                        <div th:insert="buu-component :: input-text-v3(#{name}, 'smName', '', 0, 255, true, false, ${!checkAllow})"></div>
                                        <p id="errorSmName" class="text-danger m-0"></p>
                                    </div>
                                    <div class="col-6 form-group">
                                        <div th:insert="buu-component :: input-text-v3(#{owner-name}, 'smOwnerName', '', 0, 255, true, false, ${!checkAllow})"></div>
                                        <p id="errorSmOwnerName" class="text-danger m-0"></p>
                                    </div>
                                    <div class="col-6 form-group">
                                        <div th:insert="buu-component :: input-text-v3(#{address}, 'smAddress', '', 0, 255, true, false, ${!checkAllow})"></div>
                                        <p id="errorSmAddress" class="text-danger m-0"></p>
                                    </div>
                                    <div class="col-6 form-group">
                                        <div th:insert="buu-component :: input-text-v3(#{owner-phonenumber}, 'smOwnerPhoneNumber', '', 0, 255, true, false, ${!checkAllow})"></div>
                                        <p id="errorSmOwnerPhoneNumber" class="text-danger m-0"></p>
                                    </div>
                                    <div class="col-6 form-group" th:with="options=${T(java.util.Arrays).asList(
                                        '0', 'Electoral card',
                                        '1', 'BI card',
                                        '2', 'Passport'
                                    )}">
                                        <div th:replace="buu-component :: select-default-v2(#{owner-id-paper-type}, 'smOwnerIdPaperType', '0', true, ${!checkAllow}, ${options})"></div>
                                        <p id="errorSmOwnerIdPaperType" class="text-danger m-0"></p>
                                    </div>
                                    <div class="col-6 form-group">
                                        <div th:insert="buu-component :: input-text-v3(#{owner-id-paper-number}, 'smOwnerIdPaperNumber', '', 0, 255, true, false, ${!checkAllow})"></div>
                                        <p id="errorSmOwnerIdPaperNumber" class="text-danger m-0"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modal-history-version">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" th:text="#{history-version}">History version</h4>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="body-history-version">

                </div>
                <div class="modal-footer justify-content-end">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script layout:fragment="content_page_script" th:inline="javascript">
    $(() => {
        searchSubMerchant(1, false, false);
        loadMerchant();
    })

    function submitForm(isSubmit) {
        $('#checkSubmit').val(isSubmit);
        $('#form').submit();
    }

    function approveAll(ids) {
        Swal.fire({
            title: /*[[#{vg-question-approve}]]*/ "You want to approve?",
            icon: "question",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: /*[[#{vg-confirm}]]*/ "Yes",
            cancelButtonText: /*[[#{vg-cancel}]]*/ "No"
        }).then((result) => {
            if (result.isConfirmed) {
                toastLoading();
                $.ajax({
                    url: /*[[@{'/merchant/approveAll'}]]*/ "",
                    type: 'POST',
                    data: {ids},
                    traditional: true,
                    success: (data) => {
                        toastSuccess(data);
                        window.location.href = /*[[@{/merchant/form(id=${merchant.draftFor != null ? merchant.draftFor : form.id})}]]*/ "";
                    },
                    error: (err) => {
                        toastError("An error has occurred!")
                    }
                });
            }
        });
    }

    async function disapproveAll(ids) {
        const { value: text } = await Swal.fire({
            title: /*[[#{vg-question-disapprove}]]*/ "",
            input: "textarea",
            inputPlaceholder: /*[[#{vg-reason-disapprove}]]*/ "",
            inputAttributes: {
                "aria-label": /*[[#{vg-reason-disapprove}]]*/ ""
            },
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: /*[[#{vg-confirm}]]*/ "",
            cancelButtonText: /*[[#{vg-cancel}]]*/ "",
            inputValidator: (value) => {
                if (!value) {
                    return /*[[#{vg-reason-required}]]*/ ""; // Thông báo nếu không nhập lý do
                }
            }
        });
        if (text) {
            toastLoading();
            $.ajax({
                url: /*[[@{'/merchant/disapproveAll'}]]*/ "",
                type: 'POST',
                data: {ids: ids, reason: text},
                traditional: true,
                success: (data) => {
                    toastSuccess(data);
                    window.location.reload();
                },
                error: (err) => {
                    toastError("An error has occurred!")
                }
            });
        }
    }

    function lockAll(ids) {
        Swal.fire({
            title: /*[[#{vg-question-lock}]]*/ "",
            icon: "question",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: /*[[#{vg-confirm}]]*/ "",
            cancelButtonText: /*[[#{vg-cancel}]]*/ ""
        }).then((result) => {
            if (result.isConfirmed) {
                toastLoading();
                $.ajax({
                    url: /*[[@{'/merchant/lockAll'}]]*/ "",
                    type: 'POST',
                    data: {ids},
                    traditional: true,
                    success: (data) => {
                        toastSuccess(data);
                        window.location.reload();
                    },
                    error: (err) => {
                        toastError("An error has occurred!")
                    }
                });
            }
        });
    }

    function unlockAll(ids) {
        Swal.fire({
            title: /*[[#{vg-question-unlock}]]*/ "",
            icon: "question",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: /*[[#{vg-confirm}]]*/ "",
            cancelButtonText: /*[[#{vg-cancel}]]*/ ""
        }).then((result) => {
            if (result.isConfirmed) {
                toastLoading();
                $.ajax({
                    url: /*[[@{'/merchant/unlockAll'}]]*/ "",
                    type: 'POST',
                    data: {ids},
                    traditional: true,
                    success: (data) => {
                        toastSuccess(data);
                        window.location.reload();
                    },
                    error: (err) => {
                        toastError("An error has occurred!")
                    }
                });
            }
        });
    }

    function searchSubMerchant(initPageNo, isNotifySuccess, isLoading = true) {
        if (isLoading) toastLoading();
        let pageNo = initPageNo ? initPageNo : $('#buuPaginationSubMerchant').pagination('getCurrentPage');
        let pageSize = $('#buuPageSizeSubMerchant').val();
        let smName = null;
        let idMerchant = /*[[${form.id}]]*/ -1;
        $.ajax({
            url: /*[[@{/merchant/render-sub-merchant}]]*/ "",
            type: 'GET',
            data: {
                pageNo,
                pageSize,
                idMerchant,
                smName
            },
            traditional: true,
                success: function(data) {
                $('#placeRenderSubMerchants').html(data);
                if (isNotifySuccess) {
                    toastSuccess("Success!");
                } else {
                    Swal.close();
                }
            },
            error: function(xhr, status, error) {
                toastError("An error has occurred!", 3000);
            }
        });
    }

    function searchStaff(initPageNo, isNotifySuccess, idSubMerchant, nameSubMerchant) {
        toastLoading();
        let pageNo = initPageNo ? initPageNo : $('#buuPaginationStaff').pagination('getCurrentPage');
        let pageSize = $('#buuPageSizeStaff').val();
        let sName = null;
        $.ajax({
            url: /*[[@{/merchant/render-staff}]]*/ "",
            type: 'GET',
            data: {
                pageNo,
                pageSize,
                idSubMerchant,
                sName
            },
            traditional: true,
            success: function(data) {
                $('#placeRenderStaffs').html(data);
                if (isNotifySuccess) {
                    toastSuccess("Success!");
                } else {
                    Swal.close();
                }
                $('#areaFormSubMerchant').hide();
                $('#areaStaff').show();
                $('#titleAreaStaff').text('List staff of sub merchant: ' + nameSubMerchant);
            },
            error: function(xhr, status, error) {
                toastError("An error has occurred!", 3000);
            }
        });
    }

    function hideAreaStaff() {
        $('#areaStaff').hide();
        $('#placeRenderStaffs').html('');
    }

    function hideAreaFormSubMerchant() {
        renderFormSubMerchant('Create sub merchant', {ownerIdPaperType: '0'});
        $('#areaFormSubMerchant').hide();
    }

    function renderFormSubMerchant(title, {id, name, ownerName, address, ownerPhoneNumber, ownerIdPaperType, ownerIdPaperNumber}) {
        $('#areaFormSubMerchant').show();
        $('#titleAreaFormSubMerchant').text(title);
        $('#smId').val(id);
        $('#smName').val(name);
        $('#smOwnerName').val(ownerName);
        $('#smAddress').val(address);
        $('#smOwnerPhoneNumber').val(ownerPhoneNumber);
        $('#smOwnerIdPaperType').val(ownerIdPaperType);
        $('#smOwnerIdPaperNumber').val(ownerIdPaperNumber);
    }

    function loadMerchant() {
        $.ajax({
            url: /*[[@{/merchant/find-merchant}]]*/ "",
            type: 'GET',
            data: {
                id: /*[[${form.id}]]*/ null
            },
            traditional: true,
            success: function(data) {
                $('#totalStaff').val(data.totalStaff ?? 0);
            },
            error: function(xhr, status, error) {
                toastError("An error has occurred!", 3000);
            }
        });
    }

    function saveFormSubMerchant() {
        toastLoading();
        $.ajax({
            url: /*[[@{/merchant/save-sub-merchant}]]*/ "",
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({
                id: $('#smId').val(),
                idMerchant: $('#smIdMerchant').val(),
                name: $('#smName').val(),
                ownerName: $('#smOwnerName').val(),
                address: $('#smAddress').val(),
                ownerPhoneNumber: $('#smOwnerPhoneNumber').val(),
                ownerIdPaperType: $('#smOwnerIdPaperType').val(),
                ownerIdPaperNumber: $('#smOwnerIdPaperNumber').val()
            }),
            success: function (response) {
                if (!$('#smId').val()) {
                    renderFormSubMerchant('Create sub merchant', {ownerIdPaperType: '0'});
                }
                renderErrorFormSubMerchant({});
                searchSubMerchant(null, true, true);
            },
            error: function (xhr) {
                toastError("Failed");
                error = JSON.parse(xhr.responseText);
                renderErrorFormSubMerchant(error?.error ?? {});
            }
        });
    }

    function renderErrorFormSubMerchant({address, name, ownerIdPaperNumber, ownerIdPaperType, ownerName, ownerPhoneNumber}) {
        $('#errorSmAddress').text(address ?? '');
        $('#errorSmName').text(name ?? '');
        $('#errorSmOwnerIdPaperNumber').text(ownerIdPaperNumber ?? '');
        $('#errorSmOwnerIdPaperType').text(ownerIdPaperType ?? '');
        $('#errorSmOwnerName').text(ownerName ?? '');
        $('#errorSmOwnerPhoneNumber').text(ownerPhoneNumber ?? '');
    }

    function editSubMerchant(id) {
        toastLoading();
        $.ajax({
            url: /*[[@{/merchant/find-sub-merchant}]]*/ "",
            type: 'GET',
            data: {id},
            success: function (response) {
                Swal.close();
                renderFormSubMerchant(`Edit sub merchant: ${response.name}`, response);
                hideAreaStaff();
            },
            error: function (xhr) {
                toastError("Error");
            }
        });
    }

    function deleteSubMerchant(id) {
        Swal.fire({
            title: 'Are you sure?',
            text: "You won't be able to revert this!",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: 'Yes, delete it!',
            cancelButtonText: 'No, cancel!',
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    url: /*[[@{/merchant/delete-sub-merchant}]]*/ "",
                    type: 'POST',
                    data: {id},
                    traditional: true,
                    success: function(data) {
                        if ($('#smId').val() == id) {
                            hideAreaFormSubMerchant();
                        }
                        if ($('#sIdSubMerchant').val() == id) {
                            hideAreaStaff();
                        }
                        searchSubMerchant(null, true, true);
                    },
                    error: function(xhr, status, error) {
                        toastError("An error has occurred!", 3000);
                    }
                });
            }
        });
    }





    function saveFormStaff() {
        toastLoading();
        $.ajax({
            url: /*[[@{/merchant/save-staff}]]*/ "",
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({
                id: $('#sId').val(),
                idSubMerchant: $('#sIdSubMerchant').val(),
                name: $('#sName').val(),
                phoneNumber: $('#sPhoneNumber').val()
            }),
            success: function (response) {
                searchStaff(null, true, $('#sIdSubMerchant').val(), $('#sNameSubMerchant').val());
            },
            error: function (xhr) {
                toastError("Failed");
                error = JSON.parse(xhr.responseText);
                renderErrorFormStaff(error?.error ?? {});
            }
        });
    }

    function renderErrorFormStaff({name, phoneNumber}) {
        $('#errorSName').text(name ?? '');
        $('#errorSPhoneNumber').text(phoneNumber ?? '');
    }

    function editStaff(id) {
        toastLoading();
        $.ajax({
            url: /*[[@{/merchant/find-staff}]]*/ "",
            type: 'GET',
            data: {id},
            success: function (response) {
                Swal.close();
                console.log(response)
                $('#sId').val(response?.id);
                $('#sName').val(response?.name);
                $('#sPhoneNumber').val(response?.phoneNumber);
                $('#sBtnCreate').hide();
                $('#sBtnSave').show();
                $('#sBtnCancel').show();
                renderErrorFormStaff({})
            },
            error: function (xhr) {
                toastError("Error");
            }
        });
    }

    function deleteStaff(id) {
        Swal.fire({
            title: 'Are you sure?',
            text: "You won't be able to revert this!",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: 'Yes, delete it!',
            cancelButtonText: 'No, cancel!',
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    url: /*[[@{/merchant/delete-staff}]]*/ "",
                    type: 'POST',
                    data: {id},
                    traditional: true,
                    success: function(data) {
                        searchStaff(null, true, $('#sIdSubMerchant').val(), $('#sNameSubMerchant').val());
                    },
                    error: function(xhr, status, error) {
                        toastError("An error has occurred!", 3000);
                    }
                });
            }
        });
    }

    function handleSCancel() {
        $('#sId').val('');
        $('#sName').val('');
        $('#sPhoneNumber').val('');
        $('#sBtnCreate').show();
        $('#sBtnSave').hide();
        $('#sBtnCancel').hide();
    }

    function seeHistoryVersion(id) {
        toastLoading();
        $.ajax({
            url: /*[[@{/merchant/history-version}]]*/ "",
            type: 'GET',
            data: {id},
            success: (data) => {
                Swal.close();
                $('#body-history-version').html(data);
                $('#modal-history-version').modal("show");
            },
            error: (err) => {
                console.error(err);
                toastError("An error has occurred!")
            }
        });
    }
</script>
</body>
</html>